<!DOCTYPE html>
<html>
<head>
    <title>ğŸ”¥ 4-Way Screen Share (PCâ†”Phone + Audio)</title>
    <style>
        body { font-family: Arial; margin: 20px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; }
        .options { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin: 40px 0; }
        .option-btn { padding: 25px; background: rgba(255,255,255,0.1); border: 2px solid rgba(255,255,255,0.3); border-radius: 15px; font-size: 18px; cursor: pointer; transition: all 0.3s; backdrop-filter: blur(10px); }
        .option-btn:hover { background: rgba(255,255,255,0.2); border-color: #4CAF50; transform: translateY(-5px); }
        video { width: 100%; max-width: 800px; border: 2px solid #fff; border-radius: 10px; margin: 10px 0; }
        button { padding: 12px 24px; margin: 5px; background: #4CAF50; color: white; border: none; border-radius: 8px; cursor: pointer; font-size: 16px; }
        button:hover { background: #45a049; }
        button:disabled { background: #666; cursor: not-allowed; }
        input { width: 100%; padding: 15px; margin: 10px 0; border: none; border-radius: 8px; font-size: 24px; text-align: center; text-transform: uppercase; }
        .room-code { font-size: 60px; font-weight: bold; color: #4CAF50; background: rgba(255,255,255,0.9); color: #333; padding: 25px; border-radius: 15px; text-align: center; margin: 20px 0; letter-spacing: 15px; }
        .panel { background: rgba(255,255,255,0.1); padding: 30px; border-radius: 20px; backdrop-filter: blur(10px); }
        #status { color: #4CAF50; font-weight: bold; font-size: 18px; padding: 15px; background: rgba(76,175,80,0.2); border-radius: 10px; }
        #main-panel { display: none; }
    </style>
</head>
<body>
    <h1>ğŸ”¥ Universal Screen Share (4-Way + Audio)</h1>
    <p>PC â†” Phone â†” Phone â†” PC - Sab Chalega!</p>
    
    <div class="options" id="options">
        <div class="option-btn" onclick="selectMode('pc-phone')">
            <div style="font-size: 48px;">ğŸ–¥ï¸â¡ï¸ğŸ“±</div>
            <div>PC Screen â†’ Phone</div>
        </div>
        <div class="option-btn" onclick="selectMode('phone-pc')">
            <div style="font-size: 48px;">ğŸ“±â¡ï¸ğŸ–¥ï¸</div>
            <div>Phone Screen â†’ PC</div>
        </div>
        <div class="option-btn" onclick="selectMode('phone-phone')">
            <div style="font-size: 48px;">ğŸ“±â†”ï¸ğŸ“±</div>
            <div>Phone â†” Phone</div>
        </div>
        <div class="option-btn" onclick="selectMode('pc-pc')">
            <div style="font-size: 48px;">ğŸ–¥ï¸â†”ï¸ğŸ–¥ï¸</div>
            <div>PC â†” PC</div>
        </div>
    </div>

    <div id="main-panel" class="panel">
        <div id="role-title" style="font-size: 28px; margin-bottom: 20px;"></div>
        <div id="status">Ready to connect...</div>
        
        <video id="localVideo" autoplay muted playsinline></video>
        <video id="remoteVideo" autoplay playsinline></video>
        
        <div id="room-code-display" style="display:none;">
            <h3>ğŸ“² Room Code Share Karo</h3>
            <div id="roomCode" class="room-code"></div>
            <button id="startBtn" onclick="startScreenShare()">â–¶ï¸ Start Screen + Audio Share</button>
        </div>
        
        <div id="room-input" style="display:none;">
            <h3>ğŸ”‘ Room Code Enter Karo</h3>
            <input id="roomCodeInput" type="text" maxlength="4" placeholder="ABCD">
            <button onclick="joinRoom()">âœ… Join & Connect</button>
        </div>
    </div>

    <script>
        let localStream, peerConnection, currentRoomCode, selectedMode;
        const config = { iceServers: [{urls: 'stun:stun.l.google.com:19302'}] };
        const rooms = {};

        function selectMode(mode) {
            selectedMode = mode;
            document.getElementById('options').style.display = 'none';
            document.getElementById('main-panel').style.display = 'block';
            
            const modes = {
                'pc-phone': 'ğŸ–¥ï¸ PC â†’ ğŸ“± Phone (Sharer)',
                'phone-pc': 'ğŸ“± Phone â†’ ğŸ–¥ï¸ PC (Sharer)', 
                'phone-phone': 'ğŸ“± Phone â†” ğŸ“± Phone (Sharer)',
                'pc-pc': 'ğŸ–¥ï¸ PC â†” ğŸ–¥ï¸ PC (Sharer)'
            };
            document.getElementById('role-title').innerHTML = modes[mode];
            
            // Auto-generate room for sharer
            currentRoomCode = generateRoomCode();
            document.getElementById('roomCode').textContent = currentRoomCode;
            document.getElementById('room-code-display').style.display = 'block';
            document.getElementById('status').innerHTML = `âœ… Room: ${currentRoomCode} - Dusre device pe share karo!`;
        }

        function generateRoomCode() {
            return Math.random().toString(36).substring(2,6).toUpperCase();
        }
        
        async function startScreenShare() {
            try {
                // Screen + Audio capture (Chrome 72+ support)
                localStream = await navigator.mediaDevices.getDisplayMedia({
                    video: { width: {ideal: 1920}, height: {ideal: 1080}, frameRate: {ideal: 60} },
                    audio: true  // System audio bhi capture!
                });
                
                document.getElementById('localVideo').srcObject = localStream;
                rooms[currentRoomCode] = { offer: null };
                createPeerConnection();
                
                document.getElementById('status').innerHTML = `ğŸ¥ Audio + Screen ready! Room: ${currentRoomCode}`;
            } catch(err) {
                alert('Permission denied! Chrome me "screen capture with audio" enable karo.');
            }
        }
        
        function joinRoom() {
            const code = document.getElementById('roomCodeInput').value.toUpperCase();
            if (!rooms[code]) {
                alert('âŒ Room nahi mila! Sharer pehle start kare.');
                return;
            }
            currentRoomCode = code;
            document.getElementById('room-input').style.display = 'none';
            document.getElementById('status').innerHTML = `âœ… Joined ${code} - Connecting...`;
            createPeerConnection();
        }
        
        function createPeerConnection() {
            peerConnection = new RTCPeerConnection(config);
            
            // Add local stream (sharer ya viewer dono me)
            if (localStream) {
                localStream.getTracks().forEach(track => peerConnection.addTrack(track, localStream));
            }
            
            peerConnection.ontrack = (event) => {
                document.getElementById('remoteVideo').srcObject = event.streams[0];
                document.getElementById('status').innerHTML = 'ğŸ‰ Connected! Full HD + Audio chal raha hai! ğŸ”¥';
            };
            
            peerConnection.onicecandidate = (event) => {
                if (event.candidate) console.log('ICE candidate:', event.candidate);
            };
            
            // Auto-offer for sharer
            if (rooms[currentRoomCode] && !rooms[currentRoomCode].offer && localStream) {
                peerConnection.onnegotiationneeded = async () => {
                    const offer = await peerConnection.createOffer();
                    await peerConnection.setLocalDescription(offer);
                    rooms[currentRoomCode].offer = offer;
                };
                peerConnection.onnegotiationneeded();
            } 
            // Viewer auto-answer
            else if (rooms[currentRoomCode]?.offer) {
                setRemoteOffer(rooms[currentRoomCode].offer);
            }
        }
        
        async function setRemoteOffer(offer) {
            await peerConnection.setRemoteDescription(new RTCSessionDescription(offer));
            const answer = await peerConnection.createAnswer();
            await peerConnection.setLocalDescription(answer);
        }
    </script>
</body>
</html>
